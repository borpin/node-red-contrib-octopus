<script type="text/x-red" data-template-name="octopus in">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="octopus">
    </div>
    <div class="form-row">
        <label for="node-input-region"><i class="fa fa-tag"></i> Energy Region</label>
        <select id="node-input-region" style="width:180px;">
            <option value="A">_A - East England</option>
            <option value="B">_B - East Midlands</option>
            <option value="C">_C - London</option>
            <option value="D">_D - North Wales, Merseyside and Cheshire</option>
            <option value="E">_E - West Midlands</option>
            <option value="F">_F - North East England</option>
            <option value="G">_G - North West England</option>
            <option value="H">_H - Southern England</option>
            <option value="J">_J - South East England</option>
            <option value="K">_K - South Wales</option>
            <option value="L">_L - South West England</option>
            <option value="M">_M - Yorkshire</option>
            <option value="N">_N - South Scotland</option>
            <option value="P">_P - North Scotland</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-numblocks"><i class="fa fa-globe"></i> Period length</label>
        <input type="text" id="node-input-numblocks">
    </div>
    <!-- <div class="form-row">
        <label for="node-config-input-apikey"><i class="fa fa-tasks"></i> API key</label>
        <input type="text" id="node-config-input-apikey">
    </div> -->
    <div class="form-tips">The <b>Period length</b> is the number of 30 minute blocks to average to find cheapest period of that length (e.g. 2,4 for 60 min and 120min periods).</div>
</script>

<script type="text/x-red" data-help-name="octopus in">

    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>inject
            <span class="property-type">any</span>
        </dt>
        <dd> An injection to trigger node. Recommend this is done once every 30 minutes. Node will not fire if more often.</dd>
    </dl>

    <h3>Outputs</h3>
        <ol class="node-ports">
            <li>Raw Data
                <dl class="message-properties">
                    <dt>payload <span class="property-type">object</span></dt>
                    <dd>The raw data from the API call</dd>
                </dl>
            </li>
            <dd>Processed Data
                <dl class="message-properties">
                    <dt>payload <span class="property-type">string</span></dt>
                    <dd>the standard error of the command.</dd>
                    <dt><span class="property-type"></span></dt>
                    <dd>Current period price</dd>
                    <dt><span class="property-type"></span></dt>
                    <dd>Next period price</dd>
                    <dt><span class="property-type"></span></dt>
                    <dd>Minimum Price within available data</dd>
                    <dt><span class="property-type"></span></dt>
                    <dd>Maximum Price within available data</dd>
                    <dt><span class="property-type"></span></dt>
                    <dd>An array of minimum price blocks</dd>
                    <ul>
                        <dt><span class="property-type"></span></dt>
                        <dd>Block Price (average over periods)</dd>
                        <dt><span class="property-type"></span></dt>
                        <dd>Valid from (when block period starts)</dd>
                        <dt><span class="property-type"></span></dt>
                        <dd>Length of block in minutes</dd>
                    </ul>
                </dl>
            </li>
        </ol>

    <h3>Details</h3>
        <p>The Octopus Agile API provides the ability to query how much energy will cost
            in the future. The data is broken up into 30 min periods. The data for the next 24Hrs (23:00 - 23:00) is released 
            at approximately 16:00. The number of data periods returned by the API varies between approximately 15 and 63.
        <p>This node returns the raw data and a set of processed data most likely to be useful to the user.
        <p>The API is queried once per 30 minute period as close to the boundary as possible. To force the node to
            request the data, the flow must be re-deployed.

    <h3>References</h3>
        <ul>
            <li><a>Octopus API docs</a> https://developer.octopus.energy/docs/api</li>
        </ul>
</script>

<script type="text/javascript">
    RED.nodes.registerType('octopus in',{
        category: 'input',
        color:"rgb(91, 192, 222)",
        defaults: {
            name: {value:"Octopus"},
            region: {value:"A"},
            numblocks: {value:"4"}
        },
        inputs:1,
        outputs:3,
        icon: "octopus.png",
        align: "right",
        label: function() {
            return this.name||this.region;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        // },
        // oneditprepare: function() {
        //     if (this.datatype === undefined) {
        //         $("#node-input-region").val("");
        //     }
        }
    });
</script>
